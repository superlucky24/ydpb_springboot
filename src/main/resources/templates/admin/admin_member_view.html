<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>회원정보 상세 | 관리자 메뉴</title>
    <link rel="stylesheet" th:href="@{/css/reset.css}">
    <link rel="stylesheet" th:href="@{/css/ydpb.css}">
    <link rel="stylesheet" th:href="@{/css/ydpb_community_center_view.css}">
    <script th:src="@{/js/jquery-3.3.1.min.js}"></script>
    <script th:src="@{/js/ydpb.js}"></script>
</head>
<body>
<div id="wrap">
    <header class="header" th:replace="~{admin/common/admin_header_footer::header}"></header>

    <div class="container">
        <div class="contents_wrap safe_area">

            <aside class="side_menu" th:replace="~{admin/common/admin_sidemenu::side}"></aside>

            <main>
                <div class="location">
                    <div class="location_title">
                        <h2>회원정보</h2>
                    </div>
                </div>

                <div id="board">
                    <div class="bbs_wrap">
                        <table class="p-table" style="width: 100%; border-collapse: collapse;">
                            <colgroup>
                                <col style="width: 20%;">
                                <col>
                            </colgroup>
                            <tbody>
                            <tr>
                                <th scope="row" style="padding: 15px; background: #f9f9f9; text-align: left; font-weight: 600; color: #333; border-top: 1px solid #d9d9d9; border-bottom: 1px solid #ececec;">사용자 ID</th>
                                <td th:text="${member.memId}" style="padding: 15px; border-top: 1px solid #d9d9d9; border-bottom: 1px solid #ececec;">아이디</td>
                            </tr>
                            <tr>
                                <th scope="row" style="padding: 15px; background: #f9f9f9; text-align: left; font-weight: 600; color: #333; border-bottom: 1px solid #ececec;">이름</th>
                                <td th:text="${member.memName}" style="padding: 15px; border-bottom: 1px solid #ececec;">이름</td>
                            </tr>
                            <tr>
                                <th scope="row" style="padding: 15px; background: #f9f9f9; text-align: left; font-weight: 600; color: #333; border-bottom: 1px solid #ececec;">휴대폰</th>
                                <td th:text="${member.memPhone}" style="padding: 15px; border-bottom: 1px solid #ececec;">010-0000-0000</td>
                            </tr>
                            <tr>
                                <th scope="row" style="padding: 15px; background: #f9f9f9; text-align: left; font-weight: 600; color: #333; border-bottom: 1px solid #ececec;">이메일</th>
                                <td th:text="${member.memEmail}" style="padding: 15px; border-bottom: 1px solid #ececec;">test@test.com</td>
                            </tr>
                            <tr>
                                <th scope="row" style="padding: 15px; background: #f9f9f9; text-align: left; font-weight: 600; color: #333; border-bottom: 1px solid #ececec;">가입일</th>
                                <td th:text="${#dates.format(member.memRegDate, 'yyyy-MM-dd HH:mm:ss')}" style="padding: 15px; border-bottom: 1px solid #ececec;">2025-01-15</td>
                            </tr>
<!--                            0202 귀환 추가 -->
                            <tr>
                                <th scope="row" style="padding: 15px; background: #f9f9f9; text-align: left; font-weight: 600; color: #333; border-bottom: 1px solid #ececec;">로그인 종류</th>
                                <td th:text="${member.loginType} ?: '일반'" style="padding: 15px; border-bottom: 1px solid #ececec;">일반</td>
                            </tr>
                            <tr>
                                <th scope="row" style="padding: 15px; background: #f9f9f9; text-align: left; font-weight: 600; color: #333; border-bottom: 1px solid #ececec;">
                                    <label for="memPassword">비밀번호 변경</label>
                                </th>
                                <td style="padding: 15px; border-bottom: 1px solid #ececec;">
                                    <div style="display: flex; align-items: center; gap: 8px;">
                                        <input type="hidden" name="memId" id="memId" th:value="${member.memId}">
                                        <input type="password" name="memPassword" id="memPassword" placeholder="새 비밀번호 입력" required
                                               style="padding: 5px 10px; border: 1px solid #ccc; width: 200px; height: 38px; box-sizing: border-box;">
                                        <button type="button" id="btnUpdatePass" class="p-btn" style="height: 38px; padding: 0 15px; cursor: pointer;">변경</button>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>

                        <div class="row margin_t_30" style="margin-top: 30px;">
                            <div class="col-12 clearfix">
                                <div style="float: left;">
                                    <a th:href="@{/admin/member/list(pageNum=${cri.pageNum}, amount=${cri.amount}, searchType=${cri.searchType}, searchKeyword=${cri.searchKeyword})}"
                                       class="p-btn" style="background-color: #666; border-color: #555; color: #fff; text-decoration: none; padding: 10px 20px; display: inline-block;">목록으로</a>
                                </div>
                                <div style="float: right;">
                                    <a th:href="@{/admin/member/delete(memId=${member.memId}, pageNum=${cri.pageNum}, amount=${cri.amount}, searchType=${cri.searchType}, searchKeyword=${cri.searchKeyword})}"
                                       class="p-btn"
                                       style="background-color: #d9534f; border-color: #d43f3a; color: #fff; text-decoration: none; padding: 10px 20px; display: inline-block;"
                                       onclick="return confirm('정말 이 회원을 삭제하시겠습니까?');">회원 삭제</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <footer class="footer" th:replace="~{admin/common/admin_header_footer::footer}"></footer>
</div>

<script>
    $(document).ready(function() {
        const inputPassword = $('#memPassword');

        // 비밀번호 변경 버튼 클릭 이벤트
        $('#btnUpdatePass').on('click', function() {
            const data = {
                memId: $('#memId').val(),
                memPassword: inputPassword.val()
            }

            // 관리자의 비밀번호 유효성 검사
            if(!checkPassword(data.memPassword)) {
                // 일반 사용자와 동일한 비빌번호 규칙이 필요할 경우
                // alert('비밀번호는 8자리 이상 20자리 이하 영어,특수문자,숫자를 포함해야 합니다.');
                alert('비밀번호를 입력해주세요.');
                return false;
            }

            memberService.update(data,function(result) {
                inputPassword.val('');
                alert(result);
            }, function(err) {
                inputPassword.val('');
                alert(err);
            });
        });
    });

    // 비밀번호 유효성 검사
    function checkPassword(str) {
        // 일반 사용자와 동일한 비빌번호 규칙이 필요할 경우
        // return /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,20}$/.test(str);
        return /^[A-Za-z\d@$!%*#?&]{1,20}$/.test(str);
    }

    const memberService = (function() {
        function update(data, callback, error) {
            $.ajax({
                type: "put",
                url: "/admin/member/updatepw",
                data: JSON.stringify(data),
                contentType: "application/json; charset=utf-8",
                success: function(result, status, xhr) {
                    if(callback) {
                        callback(result);
                    }
                },
                error: function(xhr, status, err) {
                    if(error) {
                        error(err);
                    }
                }
            });
        }

        return {
            update: update
        }
    })();
</script>
</body>
</html>