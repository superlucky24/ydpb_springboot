<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>우리동 갤러리 | 자치회관 | 영등포본동 주민센터</title>
    <link rel="shortcut icon" th:href="@{/images/favicon.ico}">
    <link rel="stylesheet" th:href="@{/css/reset.css}">
    <link rel="stylesheet" th:href="@{/css/ydpb.css}">
    <link rel="stylesheet" th:href="@{/css/ydpb_gallery_list.css}">

    <!-- jquery는 하나만 사용 -->
    <script th:src="@{/js/jquery-3.3.1.min.js}"></script>
    <script th:src="@{/js/prefixfree.min.js}"></script>
    <script th:src="@{/js/ydpb.js}"></script>
</head>
<body>
<div id="wrap">
    <!-- header -->
    <header class="header" th:replace="~{/admin/common/admin_header_footer::header}"></header>

    <div class="container">
        <div class="contents_wrap safe_area">

            <!-- side menu -->
            <aside class="side_menu" th:replace="~{/admin/common/admin_sidemenu::side}"></aside>

            <main>
                <!-- location -->
                <div class="location">
                    <div class="location_title">
                        <h2>우리동 갤러리</h2>
                    </div>
                </div>

                <!-- contents -->
                <div id="board" class="clearfix">
                    <div id="contents">
                        <form th:action="@{/admin/gallery/list}" method="get" id="searchForm" class="board_searchform">
                            <fieldset>
                                <legend>게시물검색</legend>
                                <div class="p-search clearfix">
                                    <div class="p-form-group">
                                        <label for="searchType" class="skip">검색항목선택</label>
                                        <select name="searchType" id="searchType" title="검색항목선택" class="p-input">
                                            <option value="T" th:selected="${cri.searchType == 'T' || cri.searchType == null}">제목</option>
                                            <option value="C" th:selected="${cri.searchType == 'C'}">내용</option>
                                            <option value="D" th:selected="${cri.searchType == 'D'}">부서</option>
                                        </select>

                                        <label for="searchKeyword" class="skip">검색어 입력</label>
                                        <input type="text" name="searchKeyword" id="searchKeyword" class="p-input"
                                               th:value="${cri.searchKeyword}">
                                        <input type="hidden" name="pageNum" th:value="${cri.pageNum}">
                                        <input type="hidden" name="amount" th:value="${cri.amount}">

                                        <span class="p-form-group__btn">
                                            <input value="검색" type="button" class="p-button">
                                        </span>
                                    </div>
                                </div>
                            </fieldset>
                        </form>
                    </div>

                    <div class="page_cou clearfix" th:if="${pageMaker != null && pageMaker.total > 0}">
                        <p>
                            총
                            <em class="em_black" th:text="${pageMaker.total}"></em>
                            개 &nbsp;[
                            <em class="em_b_black" th:text="${pageMaker.cri.pageNum}"></em>
                            / [[${pageMaker.realEnd}]] 페이지]
                        </p>
                    </div>

                    <div class="p-gallery">
                        <ul class="p-gallery-list">
                            <!-- 리스트 반복 -->
                            <li class="p-gallery-post" th:each="board : ${list}">
                                <a th:href="@{/admin/gallery/view(galId=${board.galId}, pageNum=${cri.pageNum}, amount=${cri.amount}, searchType=${cri.searchType}, searchKeyword=${cri.searchKeyword})}"
                                   class="p-gallery-post-link">

                                    <!-- 이미지 영역(첨부파일이 있으면 첫 번째 이미지 사용) -->
                                    <div class="p-gallery-post-image">
                                        <div class="p-gallery-post-image-wrap">
                                            <!-- 파일이 있을 때 -->
                                            <img th:if="${board.files != null && #lists.size(board.files) > 0}"
                                                 th:src="@{/admin/gallery/download(fileId=${board.files[0].fileId})}"
                                                 th:alt="${board.galTitle}">

                                            <!-- 파일이 없을 때 -->
                                            <img th:if="${board.files == null || #lists.size(board.files) == 0}"
                                                 th:src="@{/images/sub/no_image_icon.png}"
                                                 th:alt="${board.galTitle}">
                                        </div>

                                        <!-- NEW 표시 (작성일 기준 7일 이내) -->
                                        <div class="p-gallery-icon">
                                            <span class="p-icon p-gallery-icon-new"
                                                  th:if="${T(java.time.temporal.ChronoUnit).DAYS.between(board.galDate.toLocalDate(), T(java.time.LocalDate).now()) <= 7}">
                                                NEW
                                            </span>
                                        </div>
                                    </div>

                                    <!-- 내용 영역 -->
                                    <div class="p-gallery-post-content">
                                        <div class="p-gallery-post-content-info">
                                            <em class="p-gallery-post-content-info-text" th:text="${board.galTitle}"></em>
                                        </div>

                                        <div class="p-gallery-post-info">
                                            <time class="p-gallery-post-time p-split"
                                                  th:datetime="${#dates.format(board.galDate,'yyyy-MM-dd')}"
                                                  th:text="${#dates.format(board.galDate,'yyyy.MM.dd')}"></time>

                                            <span class="p-gallery-post-count p-split">
                                                <em class="skip">조회 :</em>
                                                <span class="p-icon">
                                                    <img th:src="@{/images/sub/icon_eye.png}" width="20" height="16"
                                                         alt="eye icon" class="p-icon-eye">
                                                </span>
                                                <span th:text="${board.galCount}"></span>
                                            </span>
                                        </div>
                                    </div>
                                </a>
                            </li>

                            <!-- 데이터 없을 때 -->
                            <li th:if="${pageMaker.total == 0}" class="p-gallery-post no_data">
                                게시글이 없습니다.
                            </li>
                        </ul>
                    </div>

                    <div class="p_ctrl" th:if="${pageMaker.total} > 0">
                        <div class="p_control">
                            <span class="p-link_b">
                                <a th:if="${pageMaker.realEnd > 10}"
                                   th:href="@{/admin/gallery/list(pageNum=1, amount=${cri.amount}, searchType=${cri.searchType}, searchKeyword=${cri.searchKeyword})}"
                                   class="p_link" title="맨 처음">&lt;&lt;</a>

                                <a th:if="${pageMaker.realEnd > 10}"
                                   th:href="@{/admin/gallery/list(pageNum=${pageMaker.prev ? pageMaker.startPage - 1 : 1}, amount=${cri.amount}, searchType=${cri.searchType}, searchKeyword=${cri.searchKeyword})}"
                                   class="p_link" title="이전">&lt;</a>

                                <th:block th:each="num : ${#numbers.sequence(pageMaker.startPage, pageMaker.endPage)}">
                                    <strong th:title="|현재 ${num}페이지|" class="p_link active"
                                            th:if="${num} == ${pageMaker.cri.pageNum}" th:text="${num}"></strong>
                                    <a th:href="@{/admin/gallery/list(pageNum=${num}, amount=${cri.amount}, searchType=${cri.searchType}, searchKeyword=${cri.searchKeyword})}"
                                       class="p_link" th:if="${num} != ${cri.pageNum}" th:text="${num}"></a>
                                </th:block>

                                <a th:if="${pageMaker.realEnd > 10}"
                                   th:href="@{/admin/gallery/list(pageNum=${pageMaker.next ? pageMaker.endPage + 1 : pageMaker.realEnd}, amount=${pageMaker.cri.amount}, searchType=${pageMaker.cri.searchType}, searchKeyword=${cri.searchKeyword})}"
                                   class="p_link" title="다음">&gt;</a>

                                <a th:if="${pageMaker.realEnd > 10}"
                                   th:href="@{/admin/gallery/list(pageNum=${pageMaker.realEnd}, amount=${cri.amount}, searchType=${cri.searchType}, searchKeyword=${cri.searchKeyword})}"
                                   class="p_link" title="맨 끝">&gt;&gt;</a>
                            </span>
                        </div>
                    </div>

                    <div class="board_btm_btns">
                        <a th:href="@{/admin/gallery/write}" class="btn btn_write">글쓰기</a>
                    </div>
                </div>
                <!-- //contents -->
            </main>
        </div>
    </div>

    <!-- footer -->
    <footer class="footer" th:replace="~{/admin/common/admin_header_footer::footer}"></footer>
</div>

<script>
    $(document).ready(function() {
        const searchForm = $('#searchForm');
        searchForm.find('.p-button').on('click', function(e) {
            e.preventDefault();
            if(!searchForm.find('input[name="searchKeyword"]').val().trim()) {
                alert('검색어를 입력해주세요.');
                return false;
            }
            searchForm.find('input[name="pageNum"]').val('1');
            searchForm.submit();
        });
    });
</script>
</body>
</html>
