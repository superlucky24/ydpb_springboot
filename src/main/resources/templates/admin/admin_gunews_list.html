<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>구청소식 | 우리동소식 | 영등포본동 주민센터</title>
    <link rel="shortcut icon" th:href="@{/images/favicon.ico}">
    <link rel="stylesheet" th:href="@{/css/reset.css}">
    <link rel="stylesheet" th:href="@{/css/ydpb.css}">
    <link rel="stylesheet" th:href="@{/css/ydpb_community_center_list.css}">
    <script th:src="@{/js/jquery-1.12.4.min.js}"></script>
    <script th:src="@{/js/prefixfree.min.js}"></script>
    <script th:src="@{/js/ydpb.js}"></script>
</head>
<body>
    <div id="wrap">
        <!-- header -->
        <header class="header" th:replace="~{/admin/common/admin_header_footer::header}"></header>
        <!-- //header -->

        <!-- container -->
        <div class="container">
            <div class="contents_wrap safe_area">
                <!-- side menu -->
                <aside class="side_menu" th:replace="~{/admin/common/admin_sidemenu::side}"></aside>
                <!-- //side menu -->

                <!-- main -->
                <main>
                    <!-- location -->
                     <div class="location">
                        <div class="location_title">
                            <h2>구청소식</h2>
                        </div>
                    </div>
                    <!-- //location -->

                    <!-- contents -->
                    <div id="board" class="clearfix">
                        <div id="contents">
                            <form th:action="@{/admin/gunews/list}" method="get" id="searchForm" class="board_searchform">
                                <fieldset>
                                    <legend>게시물검색</legend>
                                    <div class="p-search clearfix">
                                        <div class="p-form-group">
                                            <label for="amount" class="skip">검색개수선택</label>
                                            <select name="amount" id="amount" title="검색개수선택" class="p-input">
                                                <option value="10" th:selected="${cri.amount == 10 || cri.amount == null}">10</option>
                                                <option value="20" th:selected="${cri.amount == 20}">20</option>
                                                <option value="30" th:selected="${cri.amount == 30}">30</option>
                                                <option value="40" th:selected="${cri.amount == 40}">40</option>
                                                <option value="50" th:selected="${cri.amount == 50}">50</option>
                                            </select>

                                            <label for="searchType" class="skip">검색항목선택</label>
                                            <select name="searchType" id="searchType" title="검색항목선택" class="p-input">
                                                <option value="T" th:selected="${cri.searchType eq 'T' || cri.searchType == null}">제목</option>
                                                <option value="C" th:selected="${cri.searchType eq 'C'}">내용</option>
                                                <option value="D" th:selected="${cri.searchType eq 'D'}">부서</option>
                                            </select>

                                            <label for="searchKeyword" class="skip">검색어 입력</label>
                                            <input type="text" name="searchKeyword" id="searchKeyword" class="p-input" th:value="${cri.searchKeyword}">
                                            <input type="hidden" name="pageNum" th:value="${cri.pageNum}">
                                            <input type="hidden" name="amount" th:value="${cri.amount}">
                                            <span class="p-form-group__btn">
                                                <input type="submit" class="p-button" value="검색">
                                            </span>
                                        </div>
                                    </div>
                                </fieldset>
                            </form>
                        </div>

                        <div class="page_cou clearfix" th:if="${pageMaker.total} > 0">
                            <p>
                                총
                                <em class="em_black" th:text="${pageMaker.total}"></em>
                                개 &nbsp;[
                                <em class="em_b_black" th:text="${pageMaker.cri.pageNum}"></em>
                                / [[${pageMaker.realEnd}]] 페이지]
                            </p>
                        </div>

                        <table class="p_table">
                            <colgroup>
                                <col style="width: 10%;">
                                <col>
                                <col style="width: 15%;">
                                <col style="width: 15%;">
                                <col style="width: 10%;">
                            </colgroup>
                            <thead>
                            <tr>
                                <th scope="col">번호</th>
                                <th scope="col">제목</th>
                                <th scope="col">부서</th>
                                <th scope="col">작성일</th>
                                <th scope="col">조회수</th>
                            </tr>
                            </thead>
                            <tbody class="tb_text">
                                <!--/* 데이터 없음 */-->
                                <tr th:if="${pageMaker.total == 0}">
                                    <td colspan="5" class="no_data">게시글이 없습니다</td>
                                </tr>
                                <!--/* //데이터 없음 */-->

                                <tr th:each="board, iterStat : ${list}" th:object="${board}" th:with="no=${pageMaker.total - ((pageMaker.cri.pageNum - 1) * pageMaker.cri.amount)}">
                                    <td th:text="${no - iterStat.index}"></td>
                                    <td class="p_sub">
                                        <a th:href="@{/admin/gunews/view(gnewsId=*{gnewsId},pageNum=${cri.pageNum}, amount=${cri.amount}, searchType=${cri.searchType}, searchKeyword=${cri.searchKeyword})}" class="move" th:text="*{gnewsTitle}"></a>
                                        <span th:if="${board.recent}" class="board_new">NEW</span>
                                    </td>
                                    <td th:text="*{gnewsDepartment}"></td>
                                    <td><time th:datetime="*{gnewsDate}" th:text="${#dates.format(board.gnewsDate, 'yyyy.MM.dd')}"></time></td>
                                    <td th:text="*{gnewsCount}"></td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="p_ctrl" th:if="${pageMaker.total} > 0">
                            <div class="p_control">
                                <span class="p-link_b" >
                                    <a th:if="${pageMaker.realEnd > 10}"
                                       th:href="@{/admin/gunews/list(pageNum=1, amount=${cri.amount}, searchType=${cri.searchType}, searchKeyword=${cri.searchKeyword})}"
                                       class="p_link" title="맨 처음">&lt;&lt;
                                    </a>
                                    <a th:if="${pageMaker.realEnd > 10}"
                                       th:href="@{/admin/gunews/list(pageNum=${pageMaker.prev ? pageMaker.startPage - 1 : 1}, amount=${cri.amount}, searchType=${cri.searchType}, searchKeyword=${cri.searchKeyword})}"
                                       class="p_link" title="이전">&lt;
                                    </a>
                                    <th:block th:each="num : ${#numbers.sequence(pageMaker.startPage, pageMaker.endPage)}">
                                        <strong th:title="|현재 ${num}페이지|" class="p_link active" th:if="${num} == ${pageMaker.cri.pageNum}" th:text="${num}"></strong>
                                        <a th:href="@{/admin/gunews/list(pageNum=${num}, amount=${cri.amount}, searchType=${cri.searchType}, searchKeyword=${cri.searchKeyword})}" class="p_link" th:if="${num} != ${cri.pageNum}" th:text="${num}"></a>
                                    </th:block>
                                    <a th:if="${pageMaker.realEnd > 10}"
                                       th:href="@{/admin/gunews/list(pageNum=${pageMaker.next ? pageMaker.endPage + 1 : pageMaker.realEnd}, amount=${pageMaker.cri.amount}, searchType=${pageMaker.cri.searchType}, searchKeyword=${cri.searchKeyword})}"
                                       class="p_link" title="다음">&gt;
                                    </a>
                                    <a th:if="${pageMaker.realEnd > 10}"
                                       th:href="@{/admin/gunews/list(pageNum=${pageMaker.realEnd}, amount=${cri.amount}, searchType=${cri.searchType}, searchKeyword=${cri.searchKeyword})}"
                                       class="p_link" title="맨 끝">&gt;&gt;
                                    </a>
                                </span>
                            </div>
                        </div>
                        <div class="board_btm_btns">
                            <a th:href="@{/admin/gunews/write(pageNum=${cri.pageNum}, amount=${cri.amount}, searchType=${cri.searchType}, searchKeyword=${cri.searchKeyword})}" class="btn btn_write">글쓰기</a>
                        </div>
                    </div>
                    <!-- //contents -->

                </main>
                <!-- //main -->
            </div>
        </div>
        <!-- //container -->

        <!-- footer -->
        <footer class="footer" th:replace="~{/admin/common/admin_header_footer::footer}"></footer>
        <!-- //footer -->
    </div>

    <script>
        $(document).ready(function() {
            /* 검색 버튼 이벤트 처리 */
            const searchForm = $('#searchForm');
            searchForm.find('.p-button').on('click', function(e) {
                e.preventDefault();
                // keyword 값이 없을 때
                if(!searchForm.find('input[name="searchKeyword"]').val().trim()) {
                    alert('검색어를 입력해주세요.');
                    return false;
                }
                // 검색 후 페이지번호는 1페이지로 가도록 처리
                searchForm.find('input[name="pageNum"]').val('1');
                searchForm.submit();
            });

        });
    </script>

    <script th:if="${errorMsg != null and !#strings.isEmpty(errorMsg.trim())}">
        $(document).ready(function() {
            // 오류 메세지 출력
            let errorMsg = '[[${errorMsg}]]';
            if(errorMsg) {
                alert(errorMsg);
                history.replaceState({}, null, null);
            }
        });
    </script>
</body>
</html>
