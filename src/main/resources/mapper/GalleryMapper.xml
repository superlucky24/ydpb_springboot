<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.go.ydpb.mapper.GalleryMapper">

    <insert id="insert">
        INSERT INTO TBL_GALLERY(galid, galTitle, galDepartment, galContent, galTel, memId)
        VALUES (SEQ_GALLERY.nextval,#{galTitle},#{galDepartment},#{galContent},#{galTel},#{memId})
    </insert>
    <insert id="insertSelectKey">
        <selectKey keyProperty="galid" order="BEFORE" resultType="long">
            select SEQ_GALLERY.nextval from dual
        </selectKey>
        insert into TBL_GALLERY(galid,galTitle,galDepartment,galContent,galTel,memid)
        values (#{galTitle}, #{galDepartment}, #{galContent},#{galTel}, #{memId})
    </insert>

    <delete id="delete">
        delete from TBL_GALLERY where galid = #{galid}
    </delete>

    <select id="read" resultType="kr.go.ydpb.domain.GalleryVO">
        select * from TBL_GALLERY where galid = #{galid}
    </select>
    <update id="update">
        update TBL_GALLERY
        set galTitle = #{galTitle},
            galContent = #{galContent},
            galDepartment = #{galDepartment},
            galUpdatedate = sysdate
        where galId = #{galid}
    </update>

    <sql id="criteria">
        <choose>
            <when test="searchType == 'T'.toString()">
                galTitle like '%'||#{searchKeyword}||'%'
            </when>
            <when test="searchType == 'C'.toString()">
                galContent like '%'||#{searchKeyword}||'%'
            </when>
        </choose>
    </sql>

    
    <select id="getList" resultType="kr.go.ydpb.domain.GalleryVO">
        <![CDATA[
        select * from (
            select /*+INDEX_DESC(TBL_GALLERY SYS_C007039) */
                galId, galTitle, galDate, galUpdatedate, galDepartment, galContent, galCount, memId,
                ROW_NUMBER() over (order by galId desc) as rn
            from
                TBL_GALLERY
        ]]>
        <if test="searchKeyword != null and searchKeyword != ''.toString()">
            where
            <include refid="criteria"/>
        </if>
        <![CDATA[
        )
        where
            rn > (#{pageNum} - 1) * #{amount} and rn <= #{pageNum} * #{amount}
        ]]>
    </select>

    <select id="getTotalCount" resultType="int">
        select  count(*)
        from  TBL_GALLERY
        where
        <if test="searchKeyword != null and searchKeyword != ''.toString()">
            <include refid="criteria"/>
            and
        </if>
        <![CDATA[
            galId > 0
        ]]>
    </select>

    <update id="updateCount">
        UPDATE TBL_GALLERY
        SET galCount = galCount + 1
        WHERE galid = #{galId}
    </update>

    <!-- 이전글 -->
    <select id="getPrev" resultType="kr.go.ydpb.domain.GalleryVO">
        SELECT * FROM (
        SELECT   galId,  galTitle
        FROM TBL_GALLERY
        <where>
            galId &gt; #{galId}
            <if test="cri.searchKeyword != null and cri.searchKeyword != ''">
                AND
                <choose>
                    <when test="cri.searchType == 'T'">
                        galTitle LIKE '%'||#{cri.searchKeyword}||'%'
                    </when>
                    <when test="cri.searchType == 'C'">
                        galContent LIKE '%'||#{cri.searchKeyword}||'%'
                    </when>
                </choose>
            </if>
        </where>
        ORDER BY galId ASC
        )
        WHERE ROWNUM = 1
    </select>

    <!-- 다음글 -->
    <select id="getNext" resultType="kr.go.ydpb.domain.GalleryVO">
        SELECT * FROM (
        SELECT galId, galTitle
        FROM TBL_GALLERY
        <where>
            galId &lt; #{galId}
            <if test="cri.searchKeyword != null and cri.searchKeyword != ''">
                AND
                <choose>
                    <when test="cri.searchType == 'T'">
                        galTitle LIKE '%'||#{cri.searchKeyword}||'%'
                    </when>
                    <when test="cri.searchType == 'C'">
                        galContent LIKE '%'||#{cri.searchKeyword}||'%'
                    </when>
                </choose>
            </if>
        </where>
        ORDER BY galId DESC
        )
        WHERE ROWNUM = 1
    </select>


</mapper>




